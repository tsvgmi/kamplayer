<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: MPlayerRC
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo; 
    
    
    <span class="title">MPlayerRC</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: MPlayerRC
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">MPlayerRC</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">mpshell.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Remote controller for Mplayer via its RC interface.  Use the input pipe to
write command, and monitor output file for any status change.  Start method
should be used here to setup the matching interface.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MINPUT-constant" class="">MINPUT =
          
        </dt>
        <dd><pre class="code"><span class='string val'>&quot;mp.input&quot;</span>
</pre></dd>
      
        <dt id="MOUTPUT-constant" class="">MOUTPUT =
          
        </dt>
        <dd><pre class="code"><span class='string val'>&quot;mp.output&quot;</span>
</pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#rchan-instance_method" title="#rchan (instance method)">- (Object) <strong>rchan</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reader channel from slave (get output).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#wchan-instance_method" title="#wchan (instance method)">- (Object) <strong>wchan</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Writer channel to slave (send command).</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup-class_method" title="setup (class method)">+ (Object) <strong>setup</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-class_method" title="start (class method)">+ (Object) <strong>start</strong>(options) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starting the mplayer slave session.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (MPlayerRC) <strong>initialize</strong>(options = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of MPlayerRC.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#monitor_for-instance_method" title="#monitor_for (instance method)">- (Object) <strong>monitor_for</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Monitor the slave output and callback for each line</p>
<ul><li>
<p>Sleep when output is drained and retry after 1 sec</p>
</li><li>
<p>Issue get each 5 secs to get song current position.</p>
</li></ul>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#monitor_start-instance_method" title="#monitor_start (instance method)">- (Object) <strong>monitor_start</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start preparing for monitor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send-instance_method" title="#send (instance method)">- (Object) <strong>send</strong>(acmd, wait = 0) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send a command to the slave and wait/process output.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="MPlayerRC (class)">MPlayerRC</a></span></tt>) <strong>initialize</strong>(options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>A new instance of MPlayerRC</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290
291
292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 287</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
  <span class='@trace ivar id'>@trace</span>   <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:trace</span><span class='rbrack token'>]</span>
  <span class='@wchan ivar id'>@wchan</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='unless unless kw'>unless</span> <span class='test identifier id'>test</span><span class='lparen token'>(</span><span class='integer val'>?f</span><span class='comma token'>,</span> <span class='MOUTPUT constant id'>MOUTPUT</span><span class='rparen token'>)</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='MOUTPUT constant id'>MOUTPUT</span><span class='comma token'>,</span> <span class='string val'>&quot;w&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='@rchan ivar id'>@rchan</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='MOUTPUT constant id'>MOUTPUT</span><span class='rparen token'>)</span>
  <span class='@rchan ivar id'>@rchan</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="rchan-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="rchan-instance_method">
  
    - (<tt>Object</tt>) <strong>rchan</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Reader channel from slave (get output)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 285</span>

<span class='def def kw'>def</span> <span class='rchan identifier id'>rchan</span>
  <span class='@rchan ivar id'>@rchan</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="wchan-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="wchan-instance_method">
  
    - (<tt>Object</tt>) <strong>wchan</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Writer channel to slave (send command)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 286</span>

<span class='def def kw'>def</span> <span class='wchan identifier id'>wchan</span>
  <span class='@wchan ivar id'>@wchan</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="setup-class_method">
  
    + (<tt>Object</tt>) <strong>setup</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


376
377
378</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 376</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='setup identifier id'>setup</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='MOUTPUT constant id'>MOUTPUT</span><span class='comma token'>,</span> <span class='string val'>&quot;w&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="start-class_method">
  
    + (<tt>Object</tt>) <strong>start</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Starting the mplayer slave session</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 353</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='start identifier id'>start</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:sim</span><span class='rbrack token'>]</span>
  <span class='cache identifier id'>cache</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:cache</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>8000</span>
  <span class='MPlayer constant id'>MPlayer</span><span class='dot token'>.</span><span class='kill_process identifier id'>kill_process</span><span class='lparen token'>(</span><span class='regexp val'>/mplayer.*-slave/</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='test identifier id'>test</span><span class='lparen token'>(</span><span class='integer val'>?p</span><span class='comma token'>,</span> <span class='MINPUT constant id'>MINPUT</span><span class='rparen token'>)</span>
    <span class='Pf constant id'>Pf</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;mkfifo #{MINPUT}&quot;</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='popt identifier id'>popt</span> <span class='assign token'>=</span> <span class='string val'>&quot;-autosync 30 -slave -quiet -framedrop -rootwin -nograbpointer -idle&quot;</span>
  <span class='if if kw'>if</span> <span class='osd identifier id'>osd</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:osd</span><span class='rbrack token'>]</span>
    <span class='popt identifier id'>popt</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -osdlevel #{osd}&quot;</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:fs</span><span class='rbrack token'>]</span>
    <span class='popt identifier id'>popt</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; -fs&quot;</span>
  <span class='else else kw'>else</span>
    <span class='popt identifier id'>popt</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; -geometry 0:0&quot;</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='screen identifier id'>screen</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:screen</span><span class='rbrack token'>]</span>
    <span class='popt identifier id'>popt</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -xineramascreen #{screen}&quot;</span>
  <span class='end end kw'>end</span>
  <span class='Pf constant id'>Pf</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;mplayer -idx -cache #{cache} #{popt} -input file=#{MINPUT} &gt;&gt;#{MOUTPUT} 2&gt;&amp;1 &amp;&quot;</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="monitor_for-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_for</strong>(options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Monitor the slave output and callback for each line</p>
<ul><li>
<p>Sleep when output is drained and retry after 1 sec</p>
</li><li>
<p>Issue get each 5 secs to get song current position</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 340</span>

<span class='def def kw'>def</span> <span class='monitor_for identifier id'>monitor_for</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='comment val'># Loop and wait till event is detected.</span>
  <span class='lcnt identifier id'>lcnt</span>   <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='scount identifier id'>scount</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='while while kw'>while</span> <span class='true true kw'>true</span>
    <span class='while while kw'>while</span> <span class='line identifier id'>line</span> <span class='assign token'>=</span> <span class='@rchan ivar id'>@rchan</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='if if kw'>if</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='line identifier id'>line</span><span class='comma token'>,</span> <span class='lcnt identifier id'>lcnt</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='true true kw'>true</span>
      <span class='end end kw'>end</span>
      <span class='lcnt identifier id'>lcnt</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='end end kw'>end</span>
    <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>
    <span class='if if kw'>if</span> <span class='fptimer identifier id'>fptimer</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:filepos</span><span class='rbrack token'>]</span>
      <span class='scount identifier id'>scount</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='if if kw'>if</span> <span class='scount identifier id'>scount</span> <span class='geq op'>&gt;=</span> <span class='fptimer identifier id'>fptimer</span>
        <span class='send identifier id'>send</span> <span class='string val'>&quot;get&quot;</span>
        <span class='scount identifier id'>scount</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="monitor_start-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_start</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Start preparing for monitor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 333</span>

<span class='def def kw'>def</span> <span class='monitor_start identifier id'>monitor_start</span>
  <span class='@rchan ivar id'>@rchan</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="send-instance_method">
  
    - (<tt>Object</tt>) <strong>send</strong>(acmd, wait = 0) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Send a command to the slave and wait/process output. Slave is async so we
donâ€™t know when the response come and whether the response is completed. 
So have to wait.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313
314</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 301</span>

<span class='def def kw'>def</span> <span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='acmd identifier id'>acmd</span><span class='comma token'>,</span> <span class='wait identifier id'>wait</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@trace ivar id'>@trace</span>
    <span class='Plog constant id'>Plog</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Sending #{acmd}&quot;</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:sim</span><span class='rbrack token'>]</span>
  <span class='unless unless kw'>unless</span> <span class='@wchan ivar id'>@wchan</span>
    <span class='@wchan ivar id'>@wchan</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='MINPUT constant id'>MINPUT</span><span class='comma token'>,</span> <span class='string val'>&quot;w&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='@wchan ivar id'>@wchan</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{acmd}&quot;</span><span class='rparen token'>)</span>
  <span class='@wchan ivar id'>@wchan</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
  <span class='if if kw'>if</span> <span class='wait identifier id'>wait</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='get_response identifier id'>get_response</span><span class='lparen token'>(</span><span class='wait identifier id'>wait</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov 24 12:38:59 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.8.7).
</div>

  </body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: MPShell
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo; 
    
    
    <span class="title">MPShell</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: MPShell
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">MPShell</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">mpshell.rb<span class="defines">,<br />
  mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb,<br /> mpshell.rb</span>
</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MaxInitListSize-constant" class="">MaxInitListSize =
          
        </dt>
        <dd><pre class="code"><span class='integer val'>3000</span>
</pre></dd>
      
        <dt id="ShellFifo-constant" class="">ShellFifo =
          
        </dt>
        <dd><pre class="code"><span class='string val'>&quot;monrem.fifo&quot;</span>
</pre></dd>
      
        <dt id="Abbrev-constant" class="">Abbrev =
          
        </dt>
        <dd><pre class="code"><span class='lbrace token'>{</span>
  <span class='string val'>'?'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'help'</span><span class='comma token'>,</span>
  <span class='string val'>'+'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'add'</span><span class='comma token'>,</span>
  <span class='string val'>'++'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'listnew'</span><span class='comma token'>,</span>
  <span class='string val'>'-'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'disable'</span><span class='comma token'>,</span>
  <span class='string val'>'c'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'chan'</span><span class='comma token'>,</span>
  <span class='string val'>'d'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'trace'</span><span class='comma token'>,</span>
  <span class='string val'>'f'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'full'</span><span class='comma token'>,</span>
  <span class='string val'>'h'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'help'</span><span class='comma token'>,</span>
  <span class='string val'>'i'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'song_info'</span><span class='comma token'>,</span>
  <span class='string val'>'k'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pmode'</span><span class='comma token'>,</span>
  <span class='string val'>'l'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'list'</span><span class='comma token'>,</span>
  <span class='string val'>'n'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'next_song'</span><span class='comma token'>,</span>
  <span class='string val'>'p'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'prev_song'</span><span class='comma token'>,</span>
  <span class='string val'>'r'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'rewind'</span><span class='comma token'>,</span>
  <span class='string val'>'s'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'seek'</span><span class='comma token'>,</span>
  <span class='string val'>'t'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'track'</span><span class='comma token'>,</span>
  <span class='string val'>'v'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'voice'</span><span class='comma token'>,</span>
  <span class='string val'>'V'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'volume'</span><span class='comma token'>,</span>
  <span class='string val'>'w'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'wide'</span><span class='comma token'>,</span>
  <span class='string val'>'x'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'quit'</span><span class='comma token'>,</span>
<span class='rbrace token'>}</span>
</pre></dd>
      
    </dl>
  





  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_duration-class_method" title="add_duration (class method)">+ (Object) <strong>add_duration</strong>(limit = 10) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Utility function to search all files and set the song duration based on
mplayer info.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pmonitor-class_method" title="pmonitor (class method)">+ (Object) <strong>pmonitor</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run player monitor mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pmonitor2-class_method" title="pmonitor2 (class method)">+ (Object) <strong>pmonitor2</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run a simple monitor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-class_method" title="run (class method)">+ (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This is the main entry to mpshell run program.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_run-instance_method" title="#_run (instance method)">- (Object) <strong>_run</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Main run loop.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (MPShell) <strong>initialize</strong>(options) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of MPShell.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mplay-instance_method" title="#mplay (instance method)">- (Object) <strong>mplay</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run the current song in MPlayer GUI - for checking.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ns-instance_method" title="#ns (instance method)">- (Object) <strong>ns</strong>(pos = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Test vector.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remote_command-instance_method" title="#remote_command (instance method)">- (Object) <strong>remote_command</strong>(cpipe = ShellFifo) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong>(oper = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Called from menu only.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#vlc-instance_method" title="#vlc (instance method)">- (Object) <strong>vlc</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run the playlist in VLC (for checking).</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="MPShell (class)">MPShell</a></span></tt>) <strong>initialize</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>A new instance of MPShell</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


714
715
716
717
718
719
720
721
722
723
724
725
726
727</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 714</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='@playlist ivar id'>@playlist</span> <span class='assign token'>=</span> <span class='PlayListCore constant id'>PlayListCore</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;mpshell&quot;</span><span class='rparen token'>)</span>
  <span class='@options ivar id'>@options</span>  <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='if if kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:keep</span><span class='rbrack token'>]</span>
    <span class='@playlist ivar id'>@playlist</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='lparen token'>(</span><span class='MaxInitListSize constant id'>MaxInitListSize</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='@playlist ivar id'>@playlist</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>
  <span class='end end kw'>end</span>
  <span class='@player ivar id'>@player</span>    <span class='assign token'>=</span> <span class='MPlayer constant id'>MPlayer</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@playlist ivar id'>@playlist</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='@matchset ivar id'>@matchset</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@scan_mode ivar id'>@scan_mode</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='@cursong ivar id'>@cursong</span>   <span class='assign token'>=</span> <span class='@player ivar id'>@player</span><span class='dot token'>.</span><span class='cursong identifier id'>cursong</span>
  <span class='@loadat ivar id'>@loadat</span>    <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="add_duration-class_method">
  
    + (<tt>Object</tt>) <strong>add_duration</strong>(limit = 10) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Utility function to search all files and set the song duration based on
mplayer info</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1375</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='add_duration identifier id'>add_duration</span><span class='lparen token'>(</span><span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='integer val'>10</span><span class='rparen token'>)</span>
  <span class='DbAccess constant id'>DbAccess</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span>
  <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='limit identifier id'>limit</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='Song constant id'>Song</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:conditions=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;duration&lt;=60&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;path&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:limit=</span><span class='gt op'>&gt;</span><span class='limit identifier id'>limit</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='test identifier id'>test</span><span class='lparen token'>(</span><span class='integer val'>?f</span><span class='comma token'>,</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
    <span class='cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;mplayer -identify -frames 1 -nosound -nograbpointer '#{rec.path}' 2&gt;&amp;1&quot;</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='dxstring node'>`#{cmd}`</span>
    <span class='output identifier id'>output</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='grep identifier id'>grep</span><span class='lparen token'>(</span><span class='regexp val'>/ID_LENGTH/</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='output identifier id'>output</span>
      <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='duration identifier id'>duration</span> <span class='assign token'>=</span> <span class='output identifier id'>output</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^.*=/</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='Plog constant id'>Plog</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Set #{rec.song}/#{rec.artist} to #{rec.duration}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pmonitor-class_method">
  
    + (<tt>Object</tt>) <strong>pmonitor</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Run player monitor mode</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1303
1304
1305
1306</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1303</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='pmonitor identifier id'>pmonitor</span>
  <span class='DbAccess constant id'>DbAccess</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span>
  <span class='MPShell constant id'>MPShell</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='getOption identifier id'>getOption</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='_pmonitor identifier id'>_pmonitor</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pmonitor2-class_method">
  
    + (<tt>Object</tt>) <strong>pmonitor2</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Run a simple monitor.  Monitor mplayer and accept remote command</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1327</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='pmonitor2 identifier id'>pmonitor2</span>
  <span class='DbAccess constant id'>DbAccess</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span>
  <span class='options identifier id'>options</span>        <span class='assign token'>=</span> <span class='getOption identifier id'>getOption</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:keep</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='abort_on_exception identifier id'>abort_on_exception</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='ashell identifier id'>ashell</span> <span class='assign token'>=</span> <span class='MPShell constant id'>MPShell</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='monthread identifier id'>monthread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span>
    <span class='ashell identifier id'>ashell</span><span class='dot token'>.</span><span class='_pmonitor identifier id'>_pmonitor</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='cmdthread identifier id'>cmdthread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span>
    <span class='ashell identifier id'>ashell</span><span class='dot token'>.</span><span class='remote_command identifier id'>remote_command</span>
  <span class='rbrace token'>}</span>
  <span class='monthread identifier id'>monthread</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
  <span class='cmdthread identifier id'>cmdthread</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="run-class_method">
  
    + (<tt>Object</tt>) <strong>run</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>This is the main entry to mpshell run program.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1342</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run identifier id'>run</span>
  <span class='DbAccess constant id'>DbAccess</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span>

  <span class='comment val'># Override or preset config?</span>
  <span class='cf_file identifier id'>cf_file</span> <span class='assign token'>=</span> <span class='getOption identifier id'>getOption</span><span class='lparen token'>(</span><span class='symbol val'>:config</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='dstring node'>&quot;#{ENV['HOME']}/.mpshellrc&quot;</span>
  <span class='if if kw'>if</span> <span class='test identifier id'>test</span><span class='lparen token'>(</span><span class='integer val'>?f</span><span class='comma token'>,</span> <span class='cf_file identifier id'>cf_file</span><span class='rparen token'>)</span>
    <span class='MPShell constant id'>MPShell</span><span class='dot token'>.</span><span class='setOptions identifier id'>setOptions</span><span class='lparen token'>(</span><span class='YAML constant id'>YAML</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='cf_file identifier id'>cf_file</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='ashell identifier id'>ashell</span>   <span class='assign token'>=</span> <span class='MPShell constant id'>MPShell</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='getOption identifier id'>getOption</span><span class='rparen token'>)</span>
  <span class='mprocess identifier id'>mprocess</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='unless unless kw'>unless</span> <span class='getOption identifier id'>getOption</span><span class='lparen token'>(</span><span class='symbol val'>:nomonitor</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='getOption identifier id'>getOption</span><span class='lparen token'>(</span><span class='symbol val'>:readline</span><span class='rparen token'>)</span>
      <span class='MPlayer constant id'>MPlayer</span><span class='dot token'>.</span><span class='start_monitor identifier id'>start_monitor</span>
      <span class='mprocess identifier id'>mprocess</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='else else kw'>else</span>
      <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='abort_on_exception identifier id'>abort_on_exception</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span>
        <span class='ashell identifier id'>ashell</span><span class='dot token'>.</span><span class='_pmonitor identifier id'>_pmonitor</span>
      <span class='rbrace token'>}</span>
      <span class='if if kw'>if</span> <span class='cpipe identifier id'>cpipe</span> <span class='assign token'>=</span> <span class='getOption identifier id'>getOption</span><span class='lparen token'>(</span><span class='symbol val'>:cpipe</span><span class='rparen token'>)</span>
        <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span>
          <span class='ashell identifier id'>ashell</span><span class='dot token'>.</span><span class='remote_command identifier id'>remote_command</span><span class='lparen token'>(</span><span class='cpipe identifier id'>cpipe</span><span class='rparen token'>)</span>
        <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='ashell identifier id'>ashell</span><span class='dot token'>.</span><span class='_run identifier id'>_run</span>
  <span class='if if kw'>if</span> <span class='mprocess identifier id'>mprocess</span>
    <span class='MPlayer constant id'>MPlayer</span><span class='dot token'>.</span><span class='stop_monitor identifier id'>stop_monitor</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="_run-instance_method">
  
    - (<tt>Object</tt>) <strong>_run</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Main run loop.  Start with _ to hide from shell</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 790</span>

<span class='def def kw'>def</span> <span class='_run identifier id'>_run</span>
  <span class='MPlayerRC constant id'>MPlayerRC</span><span class='dot token'>.</span><span class='start identifier id'>start</span><span class='lparen token'>(</span><span class='@options ivar id'>@options</span><span class='rparen token'>)</span>
  <span class='sleep identifier id'>sleep</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='@player ivar id'>@player</span><span class='dot token'>.</span><span class='run_init identifier id'>run_init</span>
  <span class='if if kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:readline</span><span class='rbrack token'>]</span>
    <span class='_rl_init identifier id'>_rl_init</span>
  <span class='end end kw'>end</span>

  <span class='while while kw'>while</span> <span class='true true kw'>true</span>
    <span class='comment val'>#@cursong.refresh</span>
    <span class='if if kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:nomonitor</span><span class='rbrack token'>]</span>
      <span class='song_info identifier id'>song_info</span>
    <span class='end end kw'>end</span>
    <span class='puts identifier id'>puts</span> <span class='string val'>&quot;n(Next) p(Prev) f(ullscreen) h(help) v(oice) w(ide) quit\n&quot;</span>
    <span class='if if kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:readline</span><span class='rbrack token'>]</span>
      <span class='input identifier id'>input</span> <span class='assign token'>=</span> <span class='Readline constant id'>Readline</span><span class='colon2 op'>::</span><span class='readline identifier id'>readline</span><span class='lparen token'>(</span><span class='string val'>&quot;&gt; &quot;</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='print identifier id'>print</span> <span class='string val'>&quot;&gt; &quot;</span>
      <span class='STDOUT constant id'>STDOUT</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
      <span class='input identifier id'>input</span> <span class='assign token'>=</span> <span class='STDIN constant id'>STDIN</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
    <span class='end end kw'>end</span>
    <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='input identifier id'>input</span>
    <span class='done identifier id'>done</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/;/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='acommand identifier id'>acommand</span><span class='bitor op'>|</span>
      <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='oper identifier id'>oper</span> <span class='assign token'>=</span> <span class='acommand identifier id'>acommand</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^[-\+\/][\+]?/</span><span class='comma token'>,</span> <span class='string val'>'\&amp; '</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='begin begin kw'>begin</span>
        <span class='unless unless kw'>unless</span> <span class='_run_a_line identifier id'>_run_a_line</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='oper identifier id'>oper</span><span class='rparen token'>)</span>
          <span class='done identifier id'>done</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
          <span class='break break kw'>break</span>
        <span class='end end kw'>end</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='errmsg identifier id'>errmsg</span>
        <span class='p identifier id'>p</span> <span class='errmsg identifier id'>errmsg</span>
        <span class='puts identifier id'>puts</span> <span class='errmsg identifier id'>errmsg</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='done identifier id'>done</span>
    <span class='_reload identifier id'>_reload</span>
  <span class='end end kw'>end</span>

  <span class='@playlist ivar id'>@playlist</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='lparen token'>(</span><span class='MaxInitListSize constant id'>MaxInitListSize</span><span class='rparen token'>)</span>
  <span class='@player ivar id'>@player</span><span class='dot token'>.</span><span class='stop identifier id'>stop</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="mplay-instance_method">
  
    - (<tt>Object</tt>) <strong>mplay</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Run the current song in MPlayer GUI - for checking</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1298
1299
1300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1298</span>

<span class='def def kw'>def</span> <span class='mplay identifier id'>mplay</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='Pf constant id'>Pf</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;open -a 'MPlayer OSX Extended' '#{@cursong.path}'&quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ns-instance_method">
  
    - (<tt>Object</tt>) <strong>ns</strong>(pos = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Test vector</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1135
1136
1137
1138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1135</span>

<span class='def def kw'>def</span> <span class='ns identifier id'>ns</span><span class='lparen token'>(</span><span class='pos identifier id'>pos</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='next_song identifier id'>next_song</span><span class='lparen token'>(</span><span class='pos identifier id'>pos</span><span class='rparen token'>)</span>
  <span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='integer val'>60</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remote_command-instance_method">
  
    - (<tt>Object</tt>) <strong>remote_command</strong>(cpipe = ShellFifo) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1254</span>

<span class='def def kw'>def</span> <span class='remote_command identifier id'>remote_command</span><span class='lparen token'>(</span><span class='cpipe identifier id'>cpipe</span> <span class='assign token'>=</span> <span class='ShellFifo constant id'>ShellFifo</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='test identifier id'>test</span><span class='lparen token'>(</span><span class='integer val'>?p</span><span class='comma token'>,</span> <span class='cpipe identifier id'>cpipe</span><span class='rparen token'>)</span>
    <span class='Pf constant id'>Pf</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;mkfifo ./#{cpipe}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='fid identifier id'>fid</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='cpipe identifier id'>cpipe</span><span class='rparen token'>)</span>
  <span class='while while kw'>while</span> <span class='true true kw'>true</span>
    <span class='while while kw'>while</span> <span class='line identifier id'>line</span> <span class='assign token'>=</span> <span class='fid identifier id'>fid</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='oper identifier id'>oper</span> <span class='assign token'>=</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^[-\+\/][\+]?/</span><span class='comma token'>,</span> <span class='string val'>'\&amp; '</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='begin begin kw'>begin</span>
        <span class='unless unless kw'>unless</span> <span class='_run_a_line identifier id'>_run_a_line</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='oper identifier id'>oper</span><span class='rparen token'>)</span>
          <span class='done identifier id'>done</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
          <span class='break break kw'>break</span>
        <span class='end end kw'>end</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='errmsg identifier id'>errmsg</span>
        <span class='p identifier id'>p</span> <span class='errmsg identifier id'>errmsg</span>
        <span class='puts identifier id'>puts</span> <span class='errmsg identifier id'>errmsg</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
  <span class='fid identifier id'>fid</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong>(oper = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Called from menu only</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


730
731
732
733
734
735
736
737
738
739</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 730</span>

<span class='def def kw'>def</span> <span class='start identifier id'>start</span><span class='lparen token'>(</span><span class='oper identifier id'>oper</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='oper identifier id'>oper</span> <span class='opasgn op'>||=</span> <span class='string val'>&quot;&quot;</span>
  <span class='oper identifier id'>oper</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='assign identifier id'>assign</span><span class='bitor op'>|</span>
    <span class='var identifier id'>var</span><span class='comma token'>,</span> <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='assign identifier id'>assign</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/=/</span><span class='rparen token'>)</span>
    <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='var identifier id'>var</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
  <span class='end end kw'>end</span>
  <span class='MPlayerRC constant id'>MPlayerRC</span><span class='dot token'>.</span><span class='start identifier id'>start</span><span class='lparen token'>(</span><span class='@options ivar id'>@options</span><span class='rparen token'>)</span>
  <span class='sleep identifier id'>sleep</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='@player ivar id'>@player</span><span class='dot token'>.</span><span class='run_init identifier id'>run_init</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="vlc-instance_method">
  
    - (<tt>Object</tt>) <strong>vlc</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Run the playlist in VLC (for checking)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1288
1289
1290
1291
1292
1293
1294
1295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'mpshell.rb', line 1288</span>

<span class='def def kw'>def</span> <span class='vlc identifier id'>vlc</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='m3ufile identifier id'>m3ufile</span> <span class='assign token'>=</span> <span class='@playlist ivar id'>@playlist</span><span class='dot token'>.</span><span class='gen_m3u identifier id'>gen_m3u</span>
  <span class='else else kw'>else</span>
    <span class='m3ufile identifier id'>m3ufile</span> <span class='assign token'>=</span> <span class='Song constant id'>Song</span><span class='dot token'>.</span><span class='gen_m3u identifier id'>gen_m3u</span><span class='lparen token'>(</span><span class='@cursong ivar id'>@cursong</span><span class='dot token'>.</span><span class='artist identifier id'>artist</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='@cursong ivar id'>@cursong</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='Pf constant id'>Pf</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='dstring node'>&quot;open -a vlc '#{m3ufile}'&quot;</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov 24 12:38:59 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.8.7).
</div>

  </body>
</html>